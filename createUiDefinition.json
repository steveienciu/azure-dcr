{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "location": {
          "label": "Location",
          "toolTip": "Region where the Data Collection Rule will be deployed. Use the same region as your Log Analytics workspace.",
          "resourceTypes": [
            "Microsoft.Insights/dataCollectionRules"
          ]
        }
      }
    },
    "basics": [
      {
        "name": "workspaceName",
        "type": "Microsoft.Common.TextBox",
        "label": "Log Analytics workspace name",
        "defaultValue": "",
        "toolTip": "Name of the Log Analytics workspace that will receive the Windows Security events.",
        "constraints": {
          "required": true,
          "regex": "^[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]$",
          "validationMessage": "Workspace name must be 4-63 characters; alphanumeric and hyphens only."
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dcr",
        "label": "Data Collection Rule",
        "elements": [
          {
            "name": "infoDcr",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "Configure Data Collection Rules (DCRs) for Windows. You can deploy a Windows Security events DCR and/or a System and Application logs DCR to your Log Analytics workspace."
            }
          },
          {
            "name": "deployWindowsDcrs",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy Windows DCR?",
            "toolTip": "When checked, both the Windows Security DCR and the System/Application logs DCR will be created and linked to your Log Analytics workspace.",
            "constraints": {
              "required": false
            },
            "visible": true
          },
          {
            "name": "windowsDcrName",
            "type": "Microsoft.Common.TextBox",
            "label": "Windows Security DCR name",
            "defaultValue": "bv-windows-security-event-dcr",
            "toolTip": "Name for the Windows Security Data Collection Rule. Must be unique in the resource group.",
            "constraints": {
              "required": false,
              "regex": "^[A-Za-z0-9][A-Za-z0-9-_.]*[A-Za-z0-9_]$|^[A-Za-z0-9]$",
              "validationMessage": "Use alphanumeric characters, hyphens, underscores, or periods."
            },
            "visible": "[steps('dcr').deployWindowsDcrs]"
          },
          {
            "name": "systemAppDcrName",
            "type": "Microsoft.Common.TextBox",
            "label": "System/Application DCR name",
            "defaultValue": "bv-windows-system-application-dcr",
            "toolTip": "Name for the System and Application logs Data Collection Rule. Must be unique in the resource group.",
            "constraints": {
              "required": false,
              "regex": "^[A-Za-z0-9][A-Za-z0-9-_.]*[A-Za-z0-9_]$|^[A-Za-z0-9]$",
              "validationMessage": "Use alphanumeric characters, hyphens, underscores, or periods."
            },
            "visible": "[steps('dcr').deployWindowsDcrs]"
          }
        ]
      },
      {
        "name": "unmanagedCollector",
        "label": "Unmanaged Collector",
        "elements": [
          {
            "name": "deployUnmanagedCollectorDcr",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy Unmanaged Collector DCR?",
            "toolTip": "When checked, you can optionally deploy syslog, CEF, or Cisco DCRs for unmanaged collectors.",
            "constraints": {
              "required": false
            },
            "visible": true
          },
          {
            "name": "deploySyslogDcr",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy syslog DCR?",
            "toolTip": "When checked, a syslog Data Collection Rule will be created for Linux/syslog sources.",
            "constraints": {
              "required": false
            },
            "visible": "[steps('unmanagedCollector').deployUnmanagedCollectorDcr]"
          },
          {
            "name": "syslogDcrName",
            "type": "Microsoft.Common.TextBox",
            "label": "Syslog DCR name",
            "defaultValue": "bv-syslog-dcr",
            "toolTip": "Name for the syslog Data Collection Rule. Must be unique in the resource group.",
            "constraints": {
              "required": false,
              "regex": "^[A-Za-z0-9][A-Za-z0-9-_.]*[A-Za-z0-9_]$|^[A-Za-z0-9]$",
              "validationMessage": "Use alphanumeric characters, hyphens, underscores, or periods."
            },
            "visible": "[steps('unmanagedCollector').deploySyslogDcr]"
          },
          {
            "name": "deployCefDcr",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy CEF DCR?",
            "toolTip": "When checked, a Common Event Format (CEF) Data Collection Rule will be created.",
            "constraints": {
              "required": false
            },
            "visible": "[steps('unmanagedCollector').deployUnmanagedCollectorDcr]"
          },
          {
            "name": "cefDcrName",
            "type": "Microsoft.Common.TextBox",
            "label": "CEF DCR name",
            "defaultValue": "bv-cef-dcr",
            "toolTip": "Name for the CEF Data Collection Rule. Must be unique in the resource group.",
            "constraints": {
              "required": false,
              "regex": "^[A-Za-z0-9][A-Za-z0-9-_.]*[A-Za-z0-9_]$|^[A-Za-z0-9]$",
              "validationMessage": "Use alphanumeric characters, hyphens, underscores, or periods."
            },
            "visible": "[steps('unmanagedCollector').deployCefDcr]"
          },
          {
            "name": "deployCiscoDcr",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy Cisco DCR?",
            "toolTip": "Cisco DCR deployment is not yet configured. You can set the name for future use.",
            "constraints": {
              "required": false
            },
            "visible": "[steps('unmanagedCollector').deployUnmanagedCollectorDcr]"
          },
          {
            "name": "ciscoDcrName",
            "type": "Microsoft.Common.TextBox",
            "label": "Cisco DCR name",
            "defaultValue": "bv-cisco-dcr",
            "toolTip": "Name for the Cisco DCR (for future deployment). Must be unique in the resource group.",
            "constraints": {
              "required": false,
              "regex": "^[A-Za-z0-9][A-Za-z0-9-_.]*[A-Za-z0-9_]$|^[A-Za-z0-9]$",
              "validationMessage": "Use alphanumeric characters, hyphens, underscores, or periods."
            },
            "visible": "[steps('unmanagedCollector').deployCiscoDcr]"
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "workspaceResourceGroup": "[resourceGroup().name]",
      "workspaceName": "[basics('workspaceName')]",
      "deployWindowsDcr": "[steps('dcr').deployWindowsDcrs]",
      "windowsDcrName": "[steps('dcr').windowsDcrName]",
      "deploySystemAppDcr": "[steps('dcr').deployWindowsDcrs]",
      "systemAppDcrName": "[steps('dcr').systemAppDcrName]",
      "deploySyslogDcr": "[steps('unmanagedCollector').deploySyslogDcr]",
      "syslogDcrName": "[steps('unmanagedCollector').syslogDcrName]",
      "deployCefDcr": "[steps('unmanagedCollector').deployCefDcr]",
      "cefDcrName": "[steps('unmanagedCollector').cefDcrName]",
      "deployCiscoDcr": "[steps('unmanagedCollector').deployCiscoDcr]",
      "ciscoDcrName": "[steps('unmanagedCollector').ciscoDcrName]"
    }
  }
}
